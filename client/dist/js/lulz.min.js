"use strict";var lulz=angular.module("lulz",["ngResource","ngTouch","ngRoute","btford.socket-io","emd.ng-xtorage","user","post"]).constant("POST_LIMIT",100).constant("BASE_PROTECTED_API","/api/protected/").constant("OPTIONS",[{icon:"home",location:"/"},{icon:"user",location:"/user"},{icon:"pencil",modal:{id:"#post-modal"}}]);angular.module("user",[]),angular.module("post",["ngResource"]),lulz.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"partials/views/home.html",controller:"HomeController",controllerAs:"homeCtrl"}).when("/user",{templateUrl:"partials/views/user.html",controller:"UserController",controllerAs:"userCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode({enabled:!0,requireBase:!1})}]),lulz.directive("emdChangeLocationTo",["$rootScope","$location",function(a,b){var c=function(c,d,e){d.on("click",function(){a.$apply(function(){b.path(e.emdChangeLocationTo)})})};return c}]),lulz.directive("emdMoarFunnies",[function(){var a="E",b="partials/includes/moar-funnies.html",c=function(a,b){b.on("click",function(){a.loadMore()})},d={loadMore:"&"};return{restrict:a,templateUrl:b,link:c,scope:d}}]),lulz.directive("emdOptions",["OPTIONS",function(a){var b="partials/includes/emd-options.tpl.html",c=function(b,c){b.options=a,c.find(".plus-info").on("click",function(){$(".opt").slideToggle(),$(this).find(".fa").eq(0).toggleClass("fa-minus")})},d={};return{restrict:"E",templateUrl:b,link:c,scope:d}}]),lulz.directive("toTheTop",["$window",function(a){var b='<div id="to-the-top" class="hand"><i class="fa fa-angle-up"></i></div>',c=function(b,c){c.fadeOut();var d=function(){var b=$(a).scrollTop()>500?"fadeIn":"fadeOut";c[b]()};$(a).scroll(d),c.on("click",function(){a.scrollTo(0,0)})};return{restrict:"E",template:b,link:c}}]),lulz.config(["$provide","$httpProvider",function(a,b){a.service("MainInterceptor",["$q","StorageService",function(a){var b=function(b){return b||a.when(b)},c=function(b){return a.reject(b)},d=function(b){return b||a.when(b)},e=function(b){return a.reject(b)};this.request=b,this.requestError=c,this.response=d,this.responseError=e}]),b.interceptors.push("MainInterceptor")}]),lulz.service("SocketService",["socketFactory",function(a){return a()}]),lulz.service("StorageService",["$window",function(a){var b=function(b){var c=a.localStorage.getItem(b);return angular.fromJson(c)},c=function(b,c){var d=angular.toJson(c);a.localStorage.setItem(b,d)},d=function(b){a.localStorage.removeItem(b)};this.get=b,this.save=c,this.remove=d}]),lulz.controller("HomeController",["PostService","SocketService",function(a,b){var c=this,d=function(){var b=function(a){c.posts=a};a.getAll().then(b)},e=function(){b.on("post:smiledAt",function(a){for(var b=0;b<c.posts.length;b++)if(c.posts[b]._id===a._id){c.posts[b].smiles=a.smiles;break}})};c.smileAtPost=function(a){angular.isString(a)&&b.emit("post:smile",a)},c.loadMore=function(){alert("eae :D")},d(),e()}]),angular.module("post").controller("PostController",["Post","PostService",function(a,b){var c=this;c.post=a["new"](),c.createPost=function(d){var e=function(){c.post=a["new"]()};b.createPost(d).then(e)}}]),angular.module("post").factory("Post",[function(){var a={_id:null,title:null,imageUrl:null,author:null,comments:null,smiles:0,language:"EN"},b=function(b){var c=b||a;angular.extend(this,c)};return b["new"]=function(a){return new b(a)},b.prototype={isNew:function(){return!this._id},isInvalid:function(){var a=/\.(jpg|gif|png|jpeg|bmp|svg)$/i,b=!angular.isString(this.title),c=!angular.isString(this.imageUrl)||!a.test(this.imageUrl),d=!angular.isString(this.language);return b||c||d}},b}]),angular.module("post").factory("PostResource",["$resource","BASE_PROTECTED_API",function(a,b){var c=b+"post/:id",d={},e={};return a(c,d,e)}]),angular.module("post").service("PostService",["$q","PostResource",function(a,b){var c=function(){var c=a.defer(),d=function(a){var b=a||[];c.resolve(b)},e=function(a){c.reject(a)};return b.query().$promise.then(d,e),c.promise},d=function(c){var d=a.defer();if(!angular.isString(c))return d.reject(new Error("Não é possível buscar o post, id inválido.")),d.promise;var e=function(a){var b=a||{};d.resolve(b)},f=function(a){d.reject(a)};return b.get({id:c}).$promise.then(e,f),d.promise},e=function(c){var d=a.defer();if(!angular.isObject(c)||!angular.isFunction(c.isInvalid)||c.isInvalid())return d.reject(new Error("Não é possível criar o post, objeto inválido.")),d.promise;var e=function(){d.resolve()},f=function(a){d.reject(a)};return b.save(c).$promise.then(e,f),d.promise};this.getAll=c,this.getById=d,this.createPost=e}]),lulz.controller("RootController",[function(){}]),angular.module("user").controller("UserController",["$xtorage","UserService","User",function(a,b,c){var d=this;d.user=c["new"](a.get("U")),d.save=function(a){var c=function(a){d.user=a};b.createUser(a).then(c)},d.login=function(a){var c=function(a){d.user=a};b.login(a).then(c)}}]),angular.module("user").factory("User",[function(){var a={_id:null,username:null,password:null,type:"1",smiles:0,posts:[],language:"EN"},b=function(b){var c=b||a;angular.extend(this,c)};return b["new"]=function(a){return new b(a)},b.prototype={isNew:function(){return!this._id},isInvalid:function(){var a=!angular.isString(this.username),b=!angular.isString(this.language),c=!angular.isString(this.type);return a||b||c}},b}]),angular.module("user").factory("UserResource",["$resource","BASE_PROTECTED_API",function(a,b){var c=b+"user/:login",d={},e={login:{method:"POST",params:{login:"login"}}};return a(c,d,e)}]),angular.module("user").service("UserService",["$q","$xtorage","UserResource","User",function(a,b,c,d){var e=function(e){var f=a.defer();if(!angular.isObject(e)||!angular.isFunction(e.isInvalid)||e.isInvalid())return f.reject(new Error("Usuário informado não é válido. Não é possível fazer login.")),f.promise;var g=function(a){var c=new d(a);b.save("U",c),f.resolve(c)},h=function(a){f.reject(a)};return c.login(e).$promise.then(g,h),f.promise},f=function(b){var e=a.defer();if(!angular.isObject(b)||!angular.isFunction(b.isInvalid)||b.isInvalid())return e.reject(new Error("Usuário não é válido. Não é possível cadastrá-lo.")),e.promise;var f=function(a){var b=new d(a);e.resolve(b)},g=function(a){e.reject(a)};return c.save(b).$promise.then(f,g),e.promise};this.login=e,this.createUser=f}]);